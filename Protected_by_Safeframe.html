<!DOCTYPE html>
<html>
	<head>
        <title>Protected By Safeframe</title>
		<style>
		</style>
	</head>
	<body>
        <script>
           /*
           function changeFrame(window)
            {
                temp = window.document.createElement("p");
                temp.innerHTML = "Test Insert";
                window.document.body.appendChild(temp);
                document.getElementById("crypto.getRandomValues_Safeframe").contentWindow.document.body.innerHTML = "Hello";
            }

            function printMessage()
            {
                //This will cause a Cross-Site origin problem
                /// Cannot directly access the document inside of the iframe
                console.log(document.getElementById("crypto.getRandomValues_Safeframe").contentWindow.document);
            }
            //*/
        </script>
        
        <iframe id="crypto.getRandomValues_Safeframe" >

        </iframe>

        <script>            
            // Generate safeframe URL 
            ///Reference: https://securepubads.g.doubleclick.net/gpt/pubads_impl_2023010901.js?cb=31071543
            ////Archived Version: https://web.archive.org/web/20230113005605/https://securepubads.g.doubleclick.net/gpt/pubads_impl_2023010901.js?cb=31071543
            
            ///crypto.getRandomValues()
            ////Create the random number array (code from Th())
            var a;
            a = new Uint8Array(16), window.crypto.getRandomValues(a);
            ////Convert the array to a hexadecimal string (similar to what is done in Uh())
            randomValue = "";
            for(b=0; b < a.length; b++)
                c = a[b], 15 >= c && (randomValue += "0"), randomValue += c.toString(16); 
            safeframeURL = "https://" + randomValue + ".safeframe.googlesyndication.com" + "/safeframe/1-0-40/html/container.html";
            document.getElementById("crypto.getRandomValues_Safeframe").src = safeframeURL;
            //document.getElementById("crypto.getRandomValues_Safeframe").contentWindow.document.body.innerHTML = safeframeURL;
            
            //Check the status code of the safeframe before loading the final web page that will be stored in the iframe 
            /*
            var xhr = new XMLHttpRequest();
            xhr.open("HEAD", safeframeURL);
            xhr.onload = () => {
                console.log(xhr.status);
                if(xhr.status == 200)
                {
                    finalURL = "https://webar.istaging.com/?id=6GCH36GbvD1";
                    document.getElementById("crypto.getRandomValues_Safeframe").src = finalURL;
                }
            }
            xhr.send();
            //*/
            
            const h = new Headers();
            h.append('Acess-Control-Allow-Origin', 'https://*.safeframe.googlesyndication.com')
            const safeFrameReq = new Request(safeframeURL, {headers: h});
            console.log(fetch(safeFrameReq, {headers: h}));//, {header: "Acess-Control-Allow-Origin"}));

            /*
            fetch(safeFrameReq, {mode: 'cors'}).then((response) => {
                //console.log(response.status);
                if(response.status == 200)
                {
                    finalURL = "https://webar.istaging.com/?id=6GCH36GbvD1";
                    document.getElementById("crypto.getRandomValues_Safeframe").src = finalURL;
                }
            });

            /*
            counter = 0;
            while(counter < 100)
            {
                safeframeDoc =  document.getElementById("crypto.getRandomValues_Safeframe").contentWindow.document;
                //*
                if (safeframeDoc.querySelectorAll("p").length == 0){
                    temp = safeframeDoc.createElement("p");
                    temp.innerHTML = "Test Insert";
                    safeframeDoc.body.appendChild(temp);
                    //console.log(safeframeDoc.body);
                    //console.log(document.getElementById("crypto.getRandomValues_Safeframe").contentWindow);
                    //document.getElementById("crypto.getRandomValues_Safeframe").contentWindow.document.body.innerHTML = "Hello";
                }
                //document.getElementById("crypto.getRandomValues_Safeframe").contentWindow.document.body.innerHTML = safeframeURL;
                counter = counter + 1;
            }
            */
        </script>
	</body>
</html>